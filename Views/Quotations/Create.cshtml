@model CRM.Models.QuotationModel
@{
    ViewData["Title"] = "Create Quotation";
    var leads = ViewBag.Leads as List<CRM.Models.LeadModel> ?? new List<CRM.Models.LeadModel>();
    var properties = ViewBag.Properties as List<CRM.Models.PropertyModel> ?? new List<CRM.Models.PropertyModel>();
    var gstRate = (decimal)(ViewBag.GSTRate ?? 5);
}

<style>
    .create-quotation-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .section-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .section-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 1.5rem;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .section-body {
        padding: 2rem;
    }

    .items-table {
        width: 100%;
        margin-top: 1rem;
    }

    .items-table th {
        background-color: #f8f9fa;
        padding: 0.75rem;
        font-weight: 600;
        font-size: 0.875rem;
        border-bottom: 2px solid #dee2e6;
    }

    .items-table td {
        padding: 0.75rem;
        vertical-align: middle;
    }

    .item-row {
        border-bottom: 1px solid #e9ecef;
    }

    .add-item-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .add-item-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }

    .remove-item-btn {
        background-color: #dc3545;
        border: none;
        color: white;
        padding: 0.4rem 0.8rem;
        border-radius: 4px;
        cursor: pointer;
    }

    .totals-section {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 2rem;
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #dee2e6;
    }

    .total-row:last-child {
        border-bottom: none;
        font-size: 1.25rem;
        font-weight: 700;
        color: #667eea;
    }

    .submit-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 1rem 3rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1.1rem;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* Searchable Dropdown Styles */
    .position-relative .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        background-color: #fff;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }

    .position-relative .dropdown-item {
        padding: 0.5rem 1rem;
        cursor: pointer;
        border-bottom: 1px solid #f8f9fa;
    }

    .position-relative .dropdown-item:hover {
        background-color: #f8f9fa;
    }

    .position-relative .dropdown-item:last-child {
        border-bottom: none;
    }

    @@media (max-width: 768px) {
        .section-body {
            padding: 1rem;
        }

        .items-table {
            font-size: 0.85rem;
        }

        .items-table th,
        .items-table td {
            padding: 0.5rem 0.25rem;
        }

        .submit-btn {
            width: 100%;
            padding: 0.875rem;
        }
    }
</style>

<div class="content create-quotation-container">
    <!-- Breadcrumb -->
    <nav class="mb-3" aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="/Home/Index">Home</a></li>
            <li class="breadcrumb-item"><a href="/Quotations/Index">Quotations</a></li>
            <li class="breadcrumb-item active">Create New</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="mb-4">
        <h2><i class="fa-solid fa-file-invoice me-2 text-primary"></i>Create New Quotation</h2>
        <p class="text-muted">Generate a professional quotation for your lead</p>
    </div>

    <form id="quotationForm">
        <!-- Basic Information -->
        <div class="section-card">
            <div class="section-header">
                <i class="fa-solid fa-info-circle me-2"></i>Basic Information
            </div>
            <div class="section-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="LeadId" class="form-label">Select Lead *</label>
                        <div class="position-relative">
                            <input type="text" class="form-control" id="leadSearch" placeholder="Search leads..." autocomplete="off" required>
                            <input type="hidden" id="LeadId" name="LeadId" value="">
                            <div class="dropdown-menu w-100" id="leadDropdown" style="max-height: 200px; overflow-y: auto; display: none;">
                                <div class="dropdown-item" data-value="">Choose a lead...</div>
                                @foreach (var lead in leads)
                                {
                                    <div class="dropdown-item" data-value="@lead.LeadId" data-name="@lead.Name - @lead.Contact">@lead.Name - @lead.Contact</div>
                                }
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label for="PropertyId" class="form-label">Select Property *</label>
                        <div class="position-relative">
                            <input type="text" class="form-control" id="propertySearch" placeholder="Search properties..." autocomplete="off" required>
                            <input type="hidden" id="PropertyId" name="PropertyId" value="">
                            <div class="dropdown-menu w-100" id="propertyDropdown" style="max-height: 200px; overflow-y: auto; display: none;">
                                <div class="dropdown-item" data-value="">Choose a property...</div>
                                @foreach (var property in properties)
                                {
                                    <div class="dropdown-item" data-value="@property.PropertyId" data-name="@property.PropertyName">@property.PropertyName</div>
                                }
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label for="FloorId" class="form-label">Select Floor</label>
                        <div class="position-relative">
                            <input type="text" class="form-control" id="floorSearch" placeholder="Search floors..." autocomplete="off">
                            <input type="hidden" id="FloorId" name="FloorId" value="">
                            <div class="dropdown-menu w-100" id="floorDropdown" style="max-height: 200px; overflow-y: auto; display: none;">
                                <div class="dropdown-item" data-value="">Choose a floor...</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label for="FlatId" class="form-label">Select Flat (Optional)</label>
                        <div class="position-relative">
                            <input type="text" class="form-control" id="flatSearch" placeholder="Search flats..." autocomplete="off">
                            <input type="hidden" id="FlatId" name="FlatId" value="">
                            <div class="dropdown-menu w-100" id="flatDropdown" style="max-height: 200px; overflow-y: auto; display: none;">
                                <div class="dropdown-item" data-value="">Choose a flat...</div>
                            </div>
                        </div>
                    </div>


                    <div class="col-md-6">
                        <label for="ValidUntil" class="form-label">Valid Until</label>
                        <input type="date" class="form-control" id="ValidUntil" name="ValidUntil">
                    </div>

                    <div class="col-12">
                        <label for="Notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="Notes" name="Notes" rows="2" 
                                  placeholder="Additional notes or terms..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quotation Items -->
        <div class="section-card">
            <div class="section-header">
                <i class="fa-solid fa-list me-2"></i>Quotation Items
            </div>
            <div class="section-body">
                <div class="table-responsive">
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th style="width: 20%;">Item Type</th>
                                <th style="width: 35%;">Description</th>
                                <th style="width: 10%;">Qty</th>
                                <th style="width: 15%;">Amount (₹)</th>
                                <th style="width: 15%;">Total (₹)</th>
                                <th style="width: 5%;"></th>
                            </tr>
                        </thead>
                        <tbody id="itemsTableBody">
                            <tr class="item-row">
                                <td>
                                    <select class="form-select form-select-sm item-type" required>
                                        <option value="Base">Base Price</option>
                                        <option value="Parking">Parking</option>
                                        <option value="Club">Club Membership</option>
                                        <option value="Legal">Legal & Registration</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm item-description" 
                                           placeholder="Description" required>
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm item-quantity" 
                                           value="1" min="1" required>
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm item-amount" 
                                           placeholder="0" step="0.01" min="0" required>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-sm item-total" 
                                           readonly value="0">
                                </td>
                                <td>
                                    <button type="button" class="remove-item-btn" onclick="removeItem(this)" disabled>
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button type="button" class="btn add-item-btn mt-3" onclick="addItem()">
                    <i class="fa-solid fa-plus me-2"></i>Add Item
                </button>

                <!-- Totals Section -->
                <div class="totals-section">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <strong id="subtotalDisplay">₹0</strong>
                    </div>
                    <div class="total-row">
                        <span>
                            <strong>Discount %:</strong>
                            <input type="number" id="DiscountPercent" name="DiscountPercent" 
                                   value="0" step="0.01" min="0" max="100"
                                   style="width: 100px; display: inline-block; margin-left: 10px;"
                                   class="form-control form-control-sm">
                        </span>
                        <strong>Discount Amount: <span id="discountDisplay">₹0</span></strong>
                    </div>
                    <div class="total-row">
                        <span>GST (@gstRate%):</span>
                        <strong id="taxDisplay">₹0</strong>
                    </div>
                    <div class="total-row">
                        <span>Grand Total:</span>
                        <strong id="grandTotalDisplay">₹0</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center mb-5">
            <button type="submit" class="btn btn-primary submit-btn">
                <i class="fa-solid fa-save me-2"></i>Generate Quotation
            </button>
        </div>
    </form>
</div>

@section Scripts {
<script>
    const gstRate = @gstRate;

    let isSubmitting = false;
    
    $(document).ready(function() {
        console.log('=== Quotation Create Page Loaded ===');
        console.log('GST Rate:', gstRate);
        console.log('jQuery version:', $.fn.jquery);
        
        // Clear any existing handlers first
        $('#quotationForm').off();
        $(document).off('input change', '.item-quantity, .item-amount, #DiscountPercent');
        
        // Initialize searchable dropdowns
        initializeSearchableDropdowns();
        
        // Attach event listeners immediately
        attachEventListeners();
        
        // Initial calculation
        calculateTotals();
    });

    function initializeSearchableDropdowns() {
        // Lead dropdown
        setupSearchableDropdown('leadSearch', 'LeadId', 'leadDropdown');
        // Property dropdown
        setupSearchableDropdown('propertySearch', 'PropertyId', 'propertyDropdown');
        // Floor dropdown
        setupSearchableDropdown('floorSearch', 'FloorId', 'floorDropdown');
        // Flat dropdown
        setupSearchableDropdown('flatSearch', 'FlatId', 'flatDropdown');
    }

    function setupSearchableDropdown(searchId, hiddenId, dropdownId) {
        const searchInput = $('#' + searchId);
        const hiddenInput = $('#' + hiddenId);
        const dropdown = $('#' + dropdownId);
        const dropdownItems = dropdown.find('.dropdown-item');

        // Show dropdown on focus
        searchInput.on('focus', function() {
            dropdown.show();
            filterDropdownItems(dropdownItems, '');
        });

        // Hide dropdown when clicking outside
        $(document).on('click', function(e) {
            if (!searchInput.is(e.target) && !dropdown.is(e.target) && dropdown.has(e.target).length === 0) {
                dropdown.hide();
            }
        });

        // Filter on input
        searchInput.on('input', function() {
            const searchTerm = $(this).val().toLowerCase();
            filterDropdownItems(dropdownItems, searchTerm);
        });

        // Handle dropdown item selection
        dropdownItems.on('click', function() {
            const value = $(this).data('value');
            const name = $(this).data('name') || $(this).text();
            
            hiddenInput.val(value);
            searchInput.val(name);
            dropdown.hide();
            
            // Trigger change event for property to load floors
            if (hiddenId === 'PropertyId') {
                hiddenInput.trigger('change');
            }
        });
    }

    function filterDropdownItems(items, searchTerm) {
        items.each(function() {
            const text = $(this).text().toLowerCase();
            if (text.includes(searchTerm)) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    }



    function attachEventListeners() {
        // Property change - load floors
        $('#PropertyId').off('change').on('change', function() {
            console.log('Property changed:', $(this).val());
            const propertyId = $(this).val();
            $('#FloorId').html('<option value="">Choose a floor...</option>');
            $('#FlatId').html('<option value="">Choose a flat...</option>');
            
            if (propertyId) {
                loadFloors(propertyId);
            }
        });

        // Floor change - load flats
        $('#FloorId').off('change').on('change', function() {
            console.log('Floor changed:', $(this).val());
            const propertyId = $('#PropertyId').val();
            const floorNumber = $(this).find('option:selected').data('floor');
            $('#FlatId').html('<option value="">Choose a flat...</option>');
            
            if (propertyId && floorNumber) {
                loadFlats(propertyId, floorNumber);
            }
        });

        // Flat change - auto fill first item
        $('#FlatId').off('change').on('change', function() {
            console.log('Flat changed:', $(this).val());
            const flatId = $(this).val();
            if (flatId) {
                const selectedOption = $(this).find('option:selected');
                const flatPrice = selectedOption.data('price');
                const flatName = selectedOption.text();
                console.log('Flat price:', flatPrice, 'Flat name:', flatName);
                
                if (flatPrice) {
                    const firstRow = $('#itemsTableBody tr:first');
                    firstRow.find('.item-type').val('Base');
                    firstRow.find('.item-description').val(flatName);
                    firstRow.find('.item-amount').val(flatPrice);
                    calculateItemTotal(firstRow);
                }
            }
        });

        // Item changes - calculate on input
        $(document).off('input change', '.item-quantity, .item-amount, #DiscountPercent');
        $(document).on('input change', '.item-quantity, .item-amount, #DiscountPercent', function() {
            console.log('Input changed:', $(this).attr('class'), 'Value:', $(this).val());
            const row = $(this).closest('tr');
            if (row.length && ($(this).hasClass('item-amount') || $(this).hasClass('item-quantity'))) {
                calculateItemTotal(row);
            } else {
                calculateTotals();
            }
        });

        // Form submission
        $('#quotationForm').on('submit', function(e) {
            e.preventDefault();
            
            // Prevent double submission with global flag
            if (isSubmitting) {
                console.log('Already submitting, ignoring...');
                return false;
            }
            
            isSubmitting = true;
            console.log('Form submitted - setting isSubmitting to true');
            
            // Collect items - only visible rows with strict duplicate prevention
            const items = [];
            const seenItems = new Set();
            
            $('#itemsTableBody tr:visible').each(function(index) {
                const row = $(this);
                const description = row.find('.item-description').val().trim();
                const amount = parseFloat(row.find('.item-amount').val()) || 0;
                
                if (description && amount > 0) {
                    const item = {
                        itemType: row.find('.item-type').val(),
                        description: description,
                        quantity: parseInt(row.find('.item-quantity').val()) || 1,
                        amount: amount,
                        total: parseFloat(row.find('.item-total').val()) || 0
                    };
                    
                    // Create unique key
                    const itemKey = `${item.itemType}|${item.description}|${item.amount}`;
                    
                    // Only add if not seen before
                    if (!seenItems.has(itemKey)) {
                        seenItems.add(itemKey);
                        items.push(item);
                        console.log(`Added item ${items.length}:`, item);
                    } else {
                        console.log(`Skipped duplicate item:`, item);
                    }
                }
            });

            if (items.length === 0) {
                Swal.fire('Error', 'Please add at least one item', 'error');
                isSubmitting = false;
                return false;
            }
            
            console.log('Final items to submit:', items);

            // Collect form data
            const formData = {
                leadId: $('#LeadId').val(),
                propertyId: $('#PropertyId').val(),
                flatId: $('#FlatId').val() || null,
                validUntil: $('#ValidUntil').val() || null,
                notes: $('#Notes').val(),
                basePrice: items.reduce((sum, item) => sum + item.total, 0),
                discountAmount: 0,
            };

            // Calculate discount amount from percentage
            const discountPercent = parseFloat($('#DiscountPercent').val()) || 0;
            formData.discountAmount = (formData.basePrice * discountPercent) / 100;

            // Show loading
            const submitBtn = $(this).find('button[type="submit"]');
            const originalText = submitBtn.html();
            submitBtn.prop('disabled', true).html('<i class="fa-solid fa-spinner fa-spin me-2"></i>Creating...');

            // Build the data string properly
            let dataString = $.param(formData);
            items.forEach((item, index) => {
                dataString += `&items[${index}].itemType=${encodeURIComponent(item.itemType)}`;
                dataString += `&items[${index}].description=${encodeURIComponent(item.description)}`;
                dataString += `&items[${index}].quantity=${item.quantity}`;
                dataString += `&items[${index}].amount=${item.amount}`;
                dataString += `&items[${index}].total=${item.total}`;
            });

            // Submit
            $.ajax({
                url: '/Quotations/Create',
                type: 'POST',
                contentType: 'application/x-www-form-urlencoded',
                data: dataString,
                success: function(response) {
                    isSubmitting = false;
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: response.message,
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/Quotations/Details/' + response.quotationId;
                        });
                    } else {
                        Swal.fire('Error', response.message, 'error');
                        submitBtn.prop('disabled', false).html(originalText);
                    }
                },
                error: function() {
                    isSubmitting = false;
                    Swal.fire('Error', 'Failed to create quotation', 'error');
                    submitBtn.prop('disabled', false).html(originalText);
                }
            });
            
            return false;
        });
    }

    function loadFloors(propertyId) {
        $.ajax({
            url: '/Quotations/GetFloorsByProperty',
            type: 'GET',
            data: { propertyId },
            success: function(response) {
                console.log('Floors response:', response);
                if (response.success && response.floors && response.floors.length > 0) {
                    let options = '<div class="dropdown-item" data-value="">Choose a floor...</div>';
                    response.floors.forEach(floor => {
                        const floorName = `Floor ${floor.floorNumber} - ${floor.floorName || 'Floor ' + floor.floorNumber}`;
                        options += `<div class="dropdown-item" data-value="${floor.floorId}" data-floor="${floor.floorNumber}" data-name="${floorName}">${floorName}</div>`;
                    });
                    $('#floorDropdown').html(options);
                    // Re-setup floor dropdown after loading new options
                    setupSearchableDropdown('floorSearch', 'FloorId', 'floorDropdown');
                } else {
                    $('#floorDropdown').html('<div class="dropdown-item" data-value="">No floors available</div>');
                    console.log('No floors found for property:', propertyId);
                }
            },
            error: function(xhr, status, error) {
                console.error('Floor AJAX Error:', error);
                console.error('Response:', xhr.responseText);
                $('#floorDropdown').html('<div class="dropdown-item" data-value="">Error loading floors</div>');
            }
        });
    }

    function loadFlats(propertyId, floorNumber) {
        $.ajax({
            url: '/Quotations/GetFlatsByProperty',
            type: 'GET',
            data: { propertyId: propertyId, floorNumber: floorNumber },
            success: function(response) {
                console.log('Flats response:', response);
                if (response.success) {
                    let options = '<div class="dropdown-item" data-value="">Choose a flat...</div>';
                    if (response.flats && response.flats.length > 0) {
                        response.flats.forEach(flat => {
                            const price = flat.price || 0;
                            const bhk = flat.bhk || '';
                            const status = flat.status || 'Available';
                            const area = flat.area || '';
                            const flatName = `${flat.flatName} - ${bhk} - ${area} sqft - ₹${price.toLocaleString()} - ${status}`;
                            options += `<div class="dropdown-item" data-value="${flat.flatId}" data-price="${price}" data-name="${flatName}">${flatName}</div>`;
                        });
                    } else {
                        options += '<div class="dropdown-item" data-value="">No available flats</div>';
                    }
                    $('#flatDropdown').html(options);
                    // Re-setup flat dropdown after loading new options
                    setupSearchableDropdown('flatSearch', 'FlatId', 'flatDropdown');
                } else {
                    console.error('Failed to load flats');
                    $('#flatDropdown').html('<div class="dropdown-item" data-value="">Error loading flats</div>');
                }
            },
            error: function(xhr, status, error) {
                console.error('Flat AJAX Error:', error);
                console.error('Response:', xhr.responseText);
                $('#flatDropdown').html('<div class="dropdown-item" data-value="">Error loading flats</div>');
            }
        });
    }

    function addItem() {
        const newRow = `
            <tr class="item-row">
                <td>
                    <select class="form-select form-select-sm item-type" required>
                        <option value="Base">Base Price</option>
                        <option value="Parking">Parking</option>
                        <option value="Club">Club Membership</option>
                        <option value="Legal">Legal & Registration</option>
                        <option value="Other">Other</option>
                    </select>
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm item-description" 
                           placeholder="Description" required>
                </td>
                <td>
                    <input type="number" class="form-control form-control-sm item-quantity" 
                           value="1" min="1" required>
                </td>
                <td>
                    <input type="number" class="form-control form-control-sm item-amount" 
                           placeholder="0" step="0.01" min="0" required>
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm item-total" 
                           readonly value="0">
                </td>
                <td>
                    <button type="button" class="remove-item-btn" onclick="removeItem(this)">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
        $('#itemsTableBody').append(newRow);
        updateRemoveButtons();
    }

    function removeItem(btn) {
        $(btn).closest('tr').remove();
        calculateTotals();
        updateRemoveButtons();
    }

    function updateRemoveButtons() {
        const rowCount = $('#itemsTableBody tr').length;
        $('#itemsTableBody tr').each(function(index) {
            const removeBtn = $(this).find('.remove-item-btn');
            removeBtn.prop('disabled', rowCount === 1);
        });
    }

    function calculateItemTotal(row) {
        const qty = parseFloat(row.find('.item-quantity').val()) || 0;
        const amount = parseFloat(row.find('.item-amount').val()) || 0;
        const total = qty * amount;
        console.log('Calculating item total: qty=' + qty + ', amount=' + amount + ', total=' + total);
        row.find('.item-total').val(total.toFixed(2));
        
        // Trigger total calculation
        calculateTotals();
    }

    function calculateTotals() {
        let subtotal = 0;
        $('#itemsTableBody tr').each(function() {
            const total = parseFloat($(this).find('.item-total').val()) || 0;
            subtotal += total;
        });

        const discountPercent = parseFloat($('#DiscountPercent').val()) || 0;
        const discountAmount = (subtotal * discountPercent) / 100;
        const taxableAmount = subtotal - discountAmount;
        const tax = taxableAmount * (gstRate / 100);
        const grandTotal = taxableAmount + tax;

        console.log('Calculating totals: subtotal=' + subtotal + ', discount=' + discountAmount + ', tax=' + tax + ', grandTotal=' + grandTotal);

        $('#subtotalDisplay').text('₹' + subtotal.toLocaleString('en-IN', {maximumFractionDigits: 2}));
        $('#discountDisplay').text('₹' + discountAmount.toLocaleString('en-IN', {maximumFractionDigits: 2}));
        $('#taxDisplay').text('₹' + tax.toLocaleString('en-IN', {maximumFractionDigits: 2}));
        $('#grandTotalDisplay').text('₹' + grandTotal.toLocaleString('en-IN', {maximumFractionDigits: 2}));
    }
</script>

<!-- SweetAlert2 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
}
