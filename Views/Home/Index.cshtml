@{
    ViewData["Title"] = "Dashboard";
}

<style>
    @@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @@keyframes countUp { from { opacity: 0; } to { opacity: 1; } }
    @@keyframes slideInLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
    @@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @@keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
    
    .dashboard-card {
        background: white;
        border-radius: 12px;
        padding: 1.25rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid rgba(0,0,0,0.05);
        transition: all 0.3s;
        animation: fadeInUp 0.6s ease-out;
    }
    .dashboard-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(0,0,0,0.15); }
    .stat-card { position: relative; overflow: hidden; min-height: 120px; }
    .stat-number { font-size: 2.2rem; font-weight: 700; margin: 0; animation: countUp 1s ease-out; }
    .stat-label { color: #6b7280; font-size: 0.85rem; margin-top: 0.5rem; animation: slideInLeft 0.8s ease-out; }
    .stat-icon { font-size: 2.5rem; opacity: 0.15; position: absolute; right: 1rem; top: 1rem; animation: bounce 2s infinite; }
    .earning-card .stat-number { color: #10b981; }
    .expense-card .stat-number { color: #ef4444; }
    .profit-card .stat-number { color: #4f46e5; }
    .leads-card .stat-number { color: #f59e0b; }
    .chart-card { min-height: 350px; animation: fadeInUp 0.8s ease-out; }
    .chart-card canvas { height: 280px !important; }
    .table-card { min-height: 350px; animation: fadeInUp 1s ease-out; }
    .table-responsive { max-height: 280px; overflow-y: auto; }
    .table-responsive::-webkit-scrollbar { width: 6px; }
    .table-responsive::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    .table-responsive::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
    .table-responsive::-webkit-scrollbar-thumb:hover { background: #555; }
    .table-responsive::-webkit-scrollbar { width: 4px; }
    .table-responsive::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
    .animated-row { animation: slideInLeft 0.5s ease-out; }
    .dark-mode .dashboard-card { background: #222639 !important; border-color: #2c3049 !important; color: #e4e6eb !important; }
    .dark-mode .stat-label { color: #a6adc8 !important; }
    .card-1 { animation-delay: 0.1s; }
    .card-2 { animation-delay: 0.2s; }
    .card-3 { animation-delay: 0.3s; }
    .card-4 { animation-delay: 0.4s; }
    .chart-1 { animation-delay: 0.5s; }
    .chart-2 { animation-delay: 0.6s; }
    .chart-3 { animation-delay: 0.7s; }
    .chart-4 { animation-delay: 0.8s; }
    
    .btn-outline-primary {
        border: 1px solid #4f46e5 !important;
        color: #4f46e5 !important;
        background: transparent !important;
        padding: 0.375rem 0.75rem !important;
        font-size: 0.875rem !important;
        border-radius: 0.375rem !important;
        text-decoration: none !important;
        transition: all 0.2s !important;
    }
    
    .btn-outline-primary:hover {
        background: #4f46e5 !important;
        color: white !important;
        border-color: #4f46e5 !important;
    }
    
    .dark-mode .btn-outline-primary {
        border-color: #6366f1 !important;
        color: #6366f1 !important;
    }
    
    .dark-mode .btn-outline-primary:hover {
        background: #6366f1 !important;
        color: white !important;
    }
</style>

<div class="content">
    <h1 class="h3 mb-4" style="animation: fadeInUp 0.5s ease-out;"><i class="fa-solid fa-chart-line me-2"></i>Dashboard Overview</h1>

    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="dashboard-card stat-card earning-card card-1">
                <i class="fa-solid fa-sack-dollar stat-icon"></i>
                <h2 class="stat-number" id="totalEarning">₹0</h2>
                <p class="stat-label">Total Earnings</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card stat-card expense-card card-2">
                <i class="fa-solid fa-money-bill-trend-up stat-icon"></i>
                <h2 class="stat-number" id="totalExpenses">₹0</h2>
                <p class="stat-label">Total Expenses</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card stat-card profit-card card-3">
                <i class="fa-solid fa-chart-line stat-icon"></i>
                <h2 class="stat-number" id="totalProfit">₹0</h2>
                <p class="stat-label">Total Profit</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="dashboard-card stat-card leads-card card-4">
                <i class="fa-solid fa-users stat-icon"></i>
                <h2 class="stat-number" id="totalLeads">0</h2>
                <p class="stat-label">Total Leads</p>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <!-- Sales Report -->
        <div class="col-lg-8">
            <div class="dashboard-card chart-card chart-1">
                <h5 class="mb-3"><i class="fa-solid fa-chart-column me-2"></i>Sales Report (Last 6 Months)</h5>
                <canvas id="salesReportChart"></canvas>
            </div>
        </div>

        <!-- Sales Status -->
        <div class="col-lg-4">
            <div class="dashboard-card chart-card chart-2">
                <h5 class="mb-3"><i class="fa-solid fa-chart-pie me-2"></i>Sales Status</h5>
                <canvas id="salesStatusChart"></canvas>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <!-- Sales Growth -->
        <div class="col-lg-6">
            <div class="dashboard-card chart-card chart-3">
                <h5 class="mb-3"><i class="fa-solid fa-arrow-trend-up me-2"></i>Sales Growth</h5>
                <canvas id="salesGrowthChart"></canvas>
            </div>
        </div>

        <!-- All Leads List -->
        <div class="col-lg-6">
            <div class="dashboard-card table-card chart-4">
                <div class="mb-3">
                    <h5 class="mb-0"><i class="fa-solid fa-users me-2"></i>Leads List</h5>
                </div>
                <div class="table-responsive" style="max-height: 280px; overflow-y: auto;">
                    <table class="table table-sm" id="allLeadsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Stage</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <!-- Recent Activities -->
        <div class="col-lg-12">
            <div class="dashboard-card table-card chart-5">
                <h5 class="mb-3"><i class="fa-solid fa-clock me-2"></i>Recent Activities</h5>
                <div class="table-responsive">
                    <table class="table table-sm" id="recentActivitiesTable">
                        <thead>
                            <tr>
                                <th>Activity</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let charts = {};

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                loadDashboardData();
            }, 100);
        });

        function loadDashboardData() {
            const sampleData = {
                totalEarning: 125000,
                totalExpenses: 45000,
                totalProfit: 80000,
                totalLeads: 156,
                salesReport: [
                    {month: 'Jan', sales: 25000},
                    {month: 'Feb', sales: 30000},
                    {month: 'Mar', sales: 28000},
                    {month: 'Apr', sales: 35000},
                    {month: 'May', sales: 32000},
                    {month: 'Jun', sales: 40000}
                ],
                salesStatus: {paidCount: 45, pendingCount: 12, overdueCount: 3},
                recentActivities: [
                    {id: 1, type: 'Sale', amount: 15000, status: 'Paid', date: '2024-01-15'},
                    {id: 2, type: 'Lead', amount: 0, status: 'New', date: '2024-01-14'},
                    {id: 3, type: 'Booking', amount: 25000, status: 'Pending', date: '2024-01-13'}
                ],
                allLeads: [
                    {id: 1, name: 'John Smith', contact: '+91 9876543210', stage: 'New', date: '2024-01-15'},
                    {id: 2, name: 'Sarah Johnson', contact: '+91 9876543211', stage: 'Contacted', date: '2024-01-14'},
                    {id: 3, name: 'Mike Wilson', contact: '+91 9876543212', stage: 'New', date: '2024-01-13'},
                    {id: 4, name: 'Emily Davis', contact: '+91 9876543213', stage: 'Qualified', date: '2024-01-12'},
                    {id: 5, name: 'David Brown', contact: '+91 9876543214', stage: 'New', date: '2024-01-11'},
                    {id: 6, name: 'Lisa Anderson', contact: '+91 9876543215', stage: 'Site Visit', date: '2024-01-10'},
                    {id: 7, name: 'Robert Taylor', contact: '+91 9876543216', stage: 'Quotation', date: '2024-01-09'},
                    {id: 8, name: 'Jennifer White', contact: '+91 9876543217', stage: 'Negotiation', date: '2024-01-08'},
                    {id: 9, name: 'Michael Garcia', contact: '+91 9876543218', stage: 'New', date: '2024-01-07'},
                    {id: 10, name: 'Amanda Martinez', contact: '+91 9876543219', stage: 'Contacted', date: '2024-01-06'},
                    {id: 11, name: 'Christopher Lee', contact: '+91 9876543220', stage: 'Qualified', date: '2024-01-05'},
                    {id: 12, name: 'Jessica Rodriguez', contact: '+91 9876543221', stage: 'Site Visit', date: '2024-01-04'},
                    {id: 13, name: 'Daniel Thompson', contact: '+91 9876543222', stage: 'Quotation', date: '2024-01-03'},
                    {id: 14, name: 'Ashley Clark', contact: '+91 9876543223', stage: 'New', date: '2024-01-02'},
                    {id: 15, name: 'Matthew Lewis', contact: '+91 9876543224', stage: 'Contacted', date: '2024-01-01'}
                ]
            };
            animateStats(sampleData);
            renderSalesReportChart(sampleData.salesReport);
            renderSalesStatusChart(sampleData.salesStatus);
            renderSalesGrowthChart(sampleData.salesReport);
            renderAllLeads(sampleData.allLeads);
            renderRecentActivities(sampleData.recentActivities);
        }

        function animateStats(data) {
            animateNumber('totalEarning', data.totalEarning, '₹');
            animateNumber('totalExpenses', data.totalExpenses, '₹');
            animateNumber('totalProfit', data.totalProfit, '₹');
            animateNumber('totalLeads', data.totalLeads, '');
        }

        function animateNumber(elementId, targetValue, prefix = '') {
            const element = document.getElementById(elementId);
            const duration = 2000;
            const startTime = performance.now();
            const startValue = 0;

            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
                
                element.textContent = prefix + formatNumber(currentValue);
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }

        function renderSalesReportChart(data) {
            const ctx = document.getElementById('salesReportChart').getContext('2d');
            if (charts.salesReport) charts.salesReport.destroy();
            charts.salesReport = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Sales',
                        data: data.map(d => d.sales),
                        backgroundColor: '#4f46e5',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutBounce'
                    }
                }
            });
        }

        function renderSalesStatusChart(data) {
            const ctx = document.getElementById('salesStatusChart').getContext('2d');
            if (charts.salesStatus) charts.salesStatus.destroy();
            charts.salesStatus = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Paid', 'Pending', 'Overdue'],
                    datasets: [{
                        data: [data.paidCount, data.pendingCount, data.overdueCount],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutElastic'
                    }
                }
            });
        }

        function renderSalesGrowthChart(data) {
            const ctx = document.getElementById('salesGrowthChart').getContext('2d');
            if (charts.salesGrowth) charts.salesGrowth.destroy();
            charts.salesGrowth = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Sales Growth',
                        data: data.map(d => d.sales),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function renderAllLeads(data) {
            const tbody = document.querySelector('#allLeadsTable tbody');
            tbody.innerHTML = '';
            
            data.forEach((lead, index) => {
                setTimeout(() => {
                    const row = document.createElement('tr');
                    row.className = 'animated-row';
                    row.style.cursor = 'pointer';
                    row.onclick = () => window.location.href = `/Leads/Details/${lead.id}`;
                    
                    let badgeClass = 'secondary';
                    if (lead.stage === 'New') badgeClass = 'info';
                    else if (lead.stage === 'Contacted') badgeClass = 'warning';
                    else if (lead.stage === 'Qualified') badgeClass = 'success';
                    else if (lead.stage === 'Site Visit') badgeClass = 'primary';
                    else if (lead.stage === 'Quotation') badgeClass = 'info';
                    else if (lead.stage === 'Negotiation') badgeClass = 'warning';
                    
                    row.innerHTML = `
                        <td><strong>${lead.name}</strong></td>
                        <td><small>${lead.contact}</small></td>
                        <td><span class="badge bg-${badgeClass}">${lead.stage}</span></td>
                        <td><small>${lead.date}</small></td>
                    `;
                    tbody.appendChild(row);
                }, index * 50); // Reduced delay for faster loading with more items
            });
        }

        function renderRecentActivities(data) {
            const tbody = document.querySelector('#recentActivitiesTable tbody');
            tbody.innerHTML = '';
            
            data.forEach((activity, index) => {
                setTimeout(() => {
                    const row = document.createElement('tr');
                    row.className = 'animated-row';
                    row.innerHTML = `
                        <td><strong>${activity.type}</strong></td>
                        <td>${activity.amount > 0 ? '<strong>₹' + formatNumber(activity.amount) + '</strong>' : '-'}</td>
                        <td><span class="badge bg-${activity.status === 'Paid' ? 'success' : activity.status === 'Pending' ? 'warning' : activity.status === 'New' ? 'info' : 'danger'}">${activity.status}</span></td>
                        <td><small>${activity.date}</small></td>
                    `;
                    tbody.appendChild(row);
                }, index * 200);
            });
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-IN').format(num);
        }
    </script>
}